<!DOCTYPE html>
<meta charset="utf-8">
<style>

#p20{
  padding-left:10px;
}

.axis--x path {
  display: none;
}

select {
    font-size: 1em;
    margin:0.67em;
    -webkit-margin-before: 0.67em;
    -webkit-margin-after: 0.67em;
    -webkit-margin-start: 0px;
    -webkit-margin-end: 0px;
}

h1 {
  font-family: Arial;
  font-weight: normal;
}

div.legend {
  width:25px;
  height:25px;
}

.blue {
  background-color: rgb(0,149,200);
}

.red {
  background-color: rgb(186,12,47);
}

.grey {
  background-color: grey;
}

#yaxislabel{
  transform:rotate(-90deg);
  transform-origin: left top 0;
  position:relative;
  top:325px;
  
}

</style>
<body>
    <h1>
    <select id="country">
    </select>
    <select id="indicator">
        <option value="p20">P20 status</option>
        <option value="reg">Birth registration</option>
        <option value="stunt">Stunting status</option>
    </select>
    by Wealth Distribution</h1>
    <table>
      <tr>
        <td><div class="red legend"></div></td><td><span id="redNarrative">More in the P20 </span><span id="redNumber">(Maximum of 100.0%)</span></td>
      </tr>
      <tr>
        <td><div class="blue legend"></div></td><td><span id="blueNarrative">Fewer in the P20 </span><span id="blueNumber">(Minimum of 0.0%)</span></td>
      </tr>
      <tr>
        <td><div class="grey legend"></div></td><td><span id="greyNarrative">No data </span><span id="greyNumber"></span></td>
      </tr>
    </table>
    <div id="yaxislabel"><b>Percent of population</b></div>
    <svg width="960" height="500" id="p20"></svg>
    <div id="xaxislabel"><b style="position:relative;left:350px;">Percent of maximum observed wealth</b></div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
    
var isoDict = {"AD":"Andorra"
,"AE":"UAE"
,"AF":"Afghanistan"
,"AG":"Antigua & Barbuda"
,"AI":"Anguilla"
,"AL":"Albania"
,"AM":"Armenia"
,"AO":"Angola"
,"AQ":"Antarctica"
,"AR":"Argentina"
,"AS":"American Samoa"
,"AT":"Austria"
,"AU":"Australia"
,"AW":"Aruba"
,"AX":"Aland Islands"
,"AZ":"Azerbaijan"
,"BA":"Bosnia & Herzegovina"
,"BB":"Barbados"
,"BD":"Bangladesh"
,"BE":"Belgium"
,"BF":"Burkina Faso"
,"BG":"Bulgaria"
,"BH":"Bahrain"
,"BI":"Burundi"
,"BJ":"Benin"
,"BL":"Saint Barthelemy"
,"BM":"Bermuda"
,"BN":"Brunei"
,"BO":"Bolivia "
,"BQ":"BES Islands"
,"BR":"Brazil"
,"BS":"Bahamas"
,"BT":"Bhutan"
,"BV":"Bouvet Island"
,"BW":"Botswana"
,"BY":"Belarus"
,"BZ":"Belize"
,"CA":"Canada"
,"CC":"Cocos (Keeling) Islands"
,"CD":"DRC"
,"CF":"CAR"
,"CG":"Congo"
,"CH":"Switzerland"
,"CI":"Cote d'Ivoire"
,"CK":"Cook Islands"
,"CL":"Chile"
,"CM":"Cameroon"
,"CN":"China"
,"CO":"Colombia"
,"CR":"Costa Rica"
,"CU":"Cuba"
,"CV":"Cape Verde"
,"CW":"Curacao"
,"CX":"Christmas Island"
,"CY":"Cyprus"
,"CZ":"Czech Republic"
,"DE":"Germany"
,"DJ":"Djibouti"
,"DK":"Denmark"
,"DM":"Dominica"
,"DO":"Dominican Republic"
,"DZ":"Algeria"
,"EC":"Ecuador"
,"EE":"Estonia"
,"EG":"Egypt"
,"EH":"Western Sahara"
,"ER":"Eritrea"
,"ES":"Spain"
,"ET":"Ethiopia"
,"FI":"Finland"
,"FJ":"Fiji"
,"FK":"Falkland Islands "
,"FM":"Micronesia"
,"FO":"Faroe Islands"
,"FR":"France"
,"GA":"Gabon"
,"GB":"UK"
,"GD":"Grenada"
,"GE":"Georgia"
,"GF":"French Guiana"
,"GG":"Guernsey"
,"GH":"Ghana"
,"GI":"Gibraltar"
,"GL":"Greenland"
,"GM":"Gambia"
,"GN":"Guinea"
,"GP":"Guadeloupe"
,"GQ":"Equatorial Guinea"
,"GR":"Greece"
,"GS":"South Georgia & the South Sandwich Islands"
,"GT":"Guatemala"
,"GU":"Guam"
,"GW":"Guinea-Bissau"
,"GY":"Guyana"
,"HK":"Hong Kong"
,"HM":"Heard Island & McDonald Islands"
,"HN":"Honduras"
,"HR":"Croatia"
,"HT":"Haiti"
,"HU":"Hungary"
,"ID":"Indonesia"
,"IE":"Ireland"
,"IL":"Israel"
,"IM":"Isle of Man"
,"IN":"India"
,"IO":"British Indian Ocean Territory"
,"IQ":"Iraq"
,"IR":"Iran"
,"IS":"Iceland"
,"IT":"Italy"
,"JE":"Jersey"
,"JM":"Jamaica"
,"JO":"Jordan"
,"JP":"Japan"
,"KE":"Kenya"
,"KG":"Kyrgyzstan"
,"KH":"Cambodia"
,"KI":"Kiribati"
,"KM":"Comoros"
,"KN":"Saint Kitts and Nevis"
,"KP":"North Korea"
,"KR":"South Korea"
,"KW":"Kuwait"
,"KY":"Cayman Islands"
,"KZ":"Kazakhstan"
,"LA":"Lao"
,"LB":"Lebanon"
,"LC":"Saint Lucia"
,"LI":"Liechtenstein"
,"LK":"Sri Lanka"
,"LR":"Liberia"
,"LS":"Lesotho"
,"LT":"Lithuania"
,"LU":"Luxembourg"
,"LV":"Latvia"
,"LY":"Libya"
,"MA":"Morocco"
,"MC":"Monaco"
,"MD":"Moldova"
,"ME":"Montenegro"
,"MF":"Saint Martin "
,"MG":"Madagascar"
,"MH":"Marshall Islands"
,"MK":"Macedonia"
,"ML":"Mali"
,"MM":"Myanmar"
,"MN":"Mongolia"
,"MO":"Macao"
,"MP":"Northern Mariana Islands"
,"MQ":"Martinique"
,"MR":"Mauritania"
,"MS":"Montserrat"
,"MT":"Malta"
,"MU":"Mauritius"
,"MV":"Maldives"
,"MW":"Malawi"
,"MX":"Mexico"
,"MY":"Malaysia"
,"MZ":"Mozambique"
,"NA":"Namibia"
,"NC":"New Caledonia"
,"NE":"Niger"
,"NF":"Norfolk Island"
,"NG":"Nigeria"
,"NI":"Nicaragua"
,"NL":"Netherlands"
,"NO":"Norway"
,"NP":"Nepal"
,"NR":"Nauru"
,"NU":"Niue"
,"NZ":"New Zealand"
,"OM":"Oman"
,"PA":"Panama"
,"PE":"Peru"
,"PF":"French Polynesia"
,"PG":"Papua New Guinea"
,"PH":"Philippines"
,"PK":"Pakistan"
,"PL":"Poland"
,"PM":"Saint Pierre & Miquelon"
,"PN":"Pitcairn"
,"PR":"Puerto Rico"
,"PS":"Palestine"
,"PT":"Portugal"
,"PW":"Palau"
,"PY":"Paraguay"
,"QA":"Qatar"
,"RE":"Reunion"
,"RO":"Romania"
,"RS":"Serbia"
,"RU":"Russian Federation"
,"RW":"Rwanda"
,"SA":"Saudi Arabia"
,"SB":"Solomon Islands"
,"SC":"Seychelles"
,"SD":"Sudan"
,"SE":"Sweden"
,"SG":"Singapore"
,"SH":"Saint Helena, Ascension & Tristan da Cunha"
,"SI":"Slovenia"
,"SJ":"Svalbard & Jan Mayen"
,"SK":"Slovakia"
,"SL":"Sierra Leone"
,"SM":"San Marino"
,"SN":"Senegal"
,"SO":"Somalia"
,"SR":"Suriname"
,"SS":"South Sudan"
,"ST":"Sao Tome & Principe"
,"SV":"El Salvador"
,"SX":"Sint Maarten (Dutch part)"
,"SY":"Syria"
,"SZ":"Swaziland"
,"TC":"Turks & Caicos Islands"
,"TD":"Chad"
,"TF":"French Southern Territories"
,"TG":"Togo"
,"TH":"Thailand"
,"TJ":"Tajikistan"
,"TK":"Tokelau"
,"TL":"Timor-Leste"
,"TM":"Turkmenistan"
,"TN":"Tunisia"
,"TO":"Tonga"
,"TR":"Turkey"
,"TT":"Trinidad & Tobago"
,"TV":"Tuvalu"
,"TW":"Taiwan"
,"TZ":"Tanzania"
,"UA":"Ukraine"
,"UG":"Uganda"
,"UM":"United States Minor Outlying Islands"
,"US":"USA"
,"UY":"Uruguay"
,"UZ":"Uzbekistan"
,"VA":"Holy See (Vatican City State)"
,"VC":"Saint Vincent & the Grenadines"
,"VE":"Venezuela"
,"VG":"Virgin Islands (GB)"
,"VI":"Virgin Islands (US)"
,"VN":"Viet Nam"
,"VU":"Vanuatu"
,"WF":"Wallis & Futuna"
,"WS":"Samoa"
,"XK":"Kosovo"
,"YE":"Yemen"
,"YT":"Mayotte"
,"ZA":"South Africa"
,"ZM":"Zambia"
,"ZW":"Zimbabwe"
,"EU":"European Union"};

var svg = d3.select("svg"),
    margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom;

var x = d3.scaleLinear().rangeRound([0, width]),
    y = d3.scaleLinear().rangeRound([height, 0]),
    z = d3.scaleLinear().range(["rgb(0,149,200)","rgb(186,12,47)"]);

var g = svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.csv("all.dist.joined.csv",function(d){d.stops = d.stops*4; return d;}, function(error, data) {
  if (error) throw error;
  
  var isos = d3.map(data,function(d){return d.iso2;}).keys();
  var isoSelect = d3.select("#country");
    
  isoSelect.selectAll("option.iso").data(isos).enter().append("option")
        .attr('class','iso')
        .attr('value',function(d){return d})
        .text(function(d){return isoDict[d];});
    
  var iso2 = $("#country").val()
  
  var subset = data.filter(function(d){return d.iso2==iso2})

  x.domain([0,1]);
  y.domain([0, d3.max(subset, function(d) { return Number(d.counts); })]);
  z.domain([0, d3.max(subset, function(d) { return Number(d.p20s); })]);

  g.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x).ticks(10, "%"));

  var yaxis = g.append("g")
      .attr("class", "axis axis--y")
      .call(d3.axisLeft(y).ticks(10, "%"))
      
    yaxis.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", "0.71em")
      .attr("text-anchor", "end")
      .text("Frequency");

  var bars = g.selectAll(".bar")
    .data(subset)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return x(d.stops)-(width/25)+2; })
      .attr("y", function(d) { return y(d.counts); })
      .attr("width", (width/25)-1)
      .attr("height", function(d) { return height - y(d.counts); })
      .style("fill",function(d) {return d.p20s==""?"grey":z(d.p20s);});
  $('select').change(function(){
    var val = $('#indicator').val()
    var iso2 = $('#country').val()
    var subset = data.filter(function(d){return d.iso2==iso2})
    y.domain([0, d3.max(subset, function(d) { return Number(d.counts); })]);
    yaxis.transition().call(d3.axisLeft(y).ticks(10, "%"))
    if (val=="p20") {
      $("#redNarrative").text("More in the P20 ")
      $("#redNumber").text("(Maximum of 100.0%)")
      $("#blueNarrative").text("Fewer in the P20 ")
      $("#blueNumber").text("(Minimum of 0.0%)")
        z.domain([0, 1]).range(["rgb(0,149,200)","rgb(186,12,47)"]);
        bars
        .data(subset)
        .transition()
        .attr("y", function(d) { return y(d.counts); })
        .attr("height", function(d) { return height - y(d.counts); })
        .style("fill",function(d) {return d.p20s==""?"grey":z(d.p20s);});
    }else if (val=="reg") {
      var maxReg = d3.max(subset, function(d) { return Number(d.regs); });
      var minReg = d3.min(subset, function(d) { return Number(d.regs); });
      $("#redNarrative").text("Less under five birth registration ")
      $("#redNumber").text("(Minimum of "+(minReg*100).toFixed(1)+"%)")
      $("#blueNarrative").text("More under five birth registration ")
      $("#blueNumber").text("(Maximum of "+(maxReg*100).toFixed(1)+"%)")
        z.domain([minReg, maxReg]).range(["rgb(186,12,47)","rgb(0,149,200)"]);
        bars
        .data(subset)
        .transition()
        .attr("y", function(d) { return y(d.counts); })
        .attr("height", function(d) { return height - y(d.counts); })
        .style("fill",function(d) {return d.regs==""?"grey":z(d.regs);});
    }else if (val=="stunt") {
        var maxStunt = d3.max(subset, function(d) { return Number(d.stunts); });
        var minStunt = d3.min(subset, function(d) { return Number(d.stunts); });

        $("#redNarrative").text("More under five stunting ")
        $("#redNumber").text("(Maximum of "+(maxStunt*100).toFixed(1)+"%)")
        $("#blueNarrative").text("Less under five stunting ")
        $("#blueNumber").text("(Minimum of "+(minStunt*100).toFixed(1)+"%)")
        z.domain([minStunt, maxStunt]).range(["rgb(0,149,200)","rgb(186,12,47)"]);
        bars
        .data(subset)
        .transition()
        .attr("y", function(d) { return y(d.counts); })
        .attr("height", function(d) { return height - y(d.counts); })
        .style("fill",function(d) {return d.stunts==""?"grey":z(d.stunts);});
    };
  });
});

</script>
