,"GB-10"
,"XM-DAC-12-22"
,"GB-GOV-8"
,"GB-COH-RC000346"
)
i <- 1
gb <- gbs[i]
url <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat <- fromJSON(url)
View(dat)
View(dat[1])
View(dat[2])
View(dat[3])
View(dat[4])
View(dat[5])
View(dat[4])
View(dat[5])
View(dat[6])
dat <- fromJSON(url)[1]
dat <- fromJSON(url)[[1]]
View(dat)
?html_node
overviewUrl <- paste0("http://www.d-portal.org/ctrack.html?publisher=",gb,"&tongue=eng#view=publisher")
page <- html(overviewUrl)
donorname <- page %>%
html_node(".name.publisher") %>%
html_text()
donorname <- page %>%
html_node(".name.publisher")
donorname <- page %>%
html_node(".name .publisher") %>%
html_text()
donorname <- page %>%
html_node(".name")
donorname <- page %>%
html_nodes("td")
overviewUrl
datstats <- fromJSON(statsUrl)
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
datstats <- fromJSON(statsUrl)
datstats <- fromJSON(statsUrl)[[1]]
View(datstats)
datstats <- fromJSON(statsUrl)[[1]]["MAX(reporting)"]
datstats <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
library(jsonlite)
gbs <- c(
"GB-1"
,"GB-3"
,"GB-4"
,"GB-6"
,"GB-7"
,"GB-9"
,"GB-10"
,"XM-DAC-12-22"
,"GB-GOV-8"
,"GB-COH-RC000346"
)
i <- 1
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
2013url <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(2013url)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
2014url <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(2014url)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
2015url <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(2014url)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
dat <- rbind(dat2013,dat2014,dat2015)
2013url <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(2013url)[[1]]
2013url <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
dat <- rbind(dat2013,dat2014,dat2015)
View(dat2013)
View(dat2014)
View(dat2015)
View(dat2014)
View(dat2013)
View(dat2014)
View(dat2015)
View(dat2014)
View(dat2014)
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
dat <- rbind(dat2013,dat2014,dat2015)
View(dat)
library(foreach)
library(jsonlite)
library(foreach)
gbs <- c(
"GB-1"
,"GB-3"
,"GB-4"
,"GB-6"
,"GB-7"
,"GB-9"
,"GB-10"
,"XM-DAC-12-22"
,"GB-GOV-8"
,"GB-COH-RC000346"
)
data <- foreach(i=1:length(gbs),.packages=c("jsonlite")
,.combine=rbind) %do% {
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
dat <- rbind(dat2013,dat2014,dat2015)
return(dat)
}
library(jsonlite)
library(foreach)
gbs <- c(
"GB-1"
,"GB-3"
,"GB-4"
,"GB-6"
,"GB-7"
,"GB-9"
,"GB-10"
#,"XM-DAC-12-22"
,"GB-GOV-8"
,"GB-COH-RC000346"
)
data <- foreach(i=1:length(gbs),.packages=c("jsonlite")
,.combine=rbind) %do% {
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
dat <- rbind(dat2013,dat2014,dat2015)
return(dat)
}
View(dat)
?rbind
i <- 1
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
dat <- rbind(dat2013,dat2014,dat2015)
View(dat)
i <- 5
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
dat <- rbind(dat2013,dat2014,dat2015)
View(dat2013[[1]])
View(dat2013[[2]])
i <- 2
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
i <- 3
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
nrow(dat2013)
nrow(dat2015)
is.null(nrow(dat2015))
empty <- fromJSON("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=GB-1&view=publisher_sectors&_=1441789807497")
empty <- fromJSON("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=GB-1&view=publisher_sectors&_=1441789807497")[[1]]
empty <- fromJSON("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=GB-1&view=publisher_sectors&_=1441789807497")[[1]][0,]
View(empty)
empty$year <- NA
empty$donor <- NA
numeric(0)
typeof(0)
empty$year <- double(0)
empty$donor <- character(0)
i
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
nrow(dat2015)
library(jsonlite)
library(foreach)
gbs <- c(
"GB-1"
,"GB-3"
,"GB-4"
,"GB-6"
,"GB-7"
,"GB-9"
,"GB-10"
#,"XM-DAC-12-22"
,"GB-GOV-8"
,"GB-COH-RC000346"
)
empty <- fromJSON("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=GB-1&view=publisher_sectors&_=1441789807497")[[1]][0,]
empty$year <- double(0)
empty$donor <- character(0)
data <- foreach(i=1:length(gbs),.packages=c("jsonlite")
,.combine=rbind) %do% {
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
if(is.null(nrow(dat2013))){
dat2013 <- empty
}
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
if(is.null(nrow(dat2014))){
dat2014 <- empty
}
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
if(is.null(nrow(dat2015))){
dat2015 <- empty
}
dat <- rbind(dat2013,dat2014,dat2015)
return(dat)
}
View(data)
unique(data$donor)
#install.packages("treemap")
library(treemap)
wd <- "C:/git/alexm-util/DevInit/R/treemaps"
setwd(wd)
diRamp <- function(colorText1,colorText2=NA,colorText3=NA){
colorRef <- list("red"="#BA0C2F")
colorRef <- c(colorRef,"white"="#FFFFFF")
colorRef <- c(colorRef,"black"="#000000")
colorRef <- c(colorRef,"orange"="#EA7600")
colorRef <- c(colorRef,"purple"="#93328E")
colorRef <- c(colorRef,"blue"="#1B365D")
colorRef <- c(colorRef,"lightblue"="#0095CB")
colorRef <- c(colorRef,"yellow"="#B7BF10")
colorRef <- c(colorRef,"darkred"=rgb(96, 6, 24,1,maxColorValue=255))
colorRef <- c(colorRef,"pink"=rgb(251, 197, 208,1,maxColorValue=255))
colorRef <- c(colorRef,"blue4"=rgb(27, 54, 93,1,maxColorValue=255))
colorRef <- c(colorRef,"blue3"=rgb(73, 94, 125,1,maxColorValue=255))
colorRef <- c(colorRef,"blue2"=rgb(118, 134, 158,1,maxColorValue=255))
colorRef <- c(colorRef,"blue1"=rgb(164, 175, 190,1,maxColorValue=255))
colorRef <- c(colorRef,"blue0"=rgb(209, 215, 223,1,maxColorValue=255))
if(!is.na(colorText2)){
if(!is.na(colorText3)){
color1 <- colorRef[[colorText1]]
if(is.null(color1)){color1 <- colorText1}
color2 <- colorRef[[colorText2]]
if(is.null(color2)){color2 <- colorText2}
color3 <- colorRef[[colorText3]]
if(is.null(color3)){color3 <- colorText3}
colorRamp(c(color1,color2,color3), interpolate="linear")
}else{
color1 <- colorRef[[colorText1]]
if(is.null(color1)){color1 <- colorText1}
color2 <- colorRef[[colorText2]]
if(is.null(color2)){color2 <- colorText2}
colorRamp(c(color1,color2), interpolate="linear")
}
}else{
color1 <- colorRef[["white"]]
color2 <- colorRef[[colorText1]]
if(is.null(color2)){color2 <- colorText2}
colorRamp(c(color1,color2), interpolate="linear")
}
}
treeMapRamp <- function(vector){
vectorMax = max(vector)
message(vectorMax)
colors <- c()
for(i in 1:length(vector)){
newVal <- vector[i]/vectorMax
if(vector[i]>0){
rgb <- diRamp("red")(newVal)
color <- substr(rgb(rgb[1,1],rgb[1,2],rgb[1,3],1,maxColorValue=255),1,7)
colors <- c(colors,color)
}else{
color <- "#cccccc"
colors <- c(colors,color)
}
}
return(colors)
}
data <- read.csv("treemaps.csv",na.strings="")
data <- data[,1:3]
entities <- read.csv("C:/git/digital-platform/reference/entity.csv",na.strings="",as.is=TRUE)
entities$name[44] <- "Cote d'Ivoire"
entities$name[241] <- "Vietnam"
data <- merge(
data
,entities
,by.x="country.id"
,by.y="id"
)
depth <- subset(data,flow=="depth")
names(depth)[3] <- "depth"
oda <- subset(data,flow=="oda")
oda <- subset(oda,value>0)
oda <- merge(oda
,depth
,by=c("country.id")
,all.x=TRUE)
oda <- transform(oda,color=treeMapRamp(depth))
fdi <- subset(data,flow=="fdi")
fdi <- subset(fdi,value>0)
fdi <- merge(fdi
,depth
,by=c("country.id")
,all.x=TRUE)
fdi <- transform(fdi,color=treeMapRamp(depth))
longdebt <- subset(data,flow=="longdebt")
longdebt <- subset(longdebt,value>0)
longdebt <- merge(longdebt
,depth
,by=c("country.id")
,all.x=TRUE)
longdebt <- transform(longdebt,color=treeMapRamp(depth))
remittances <- subset(data,flow=="remittances")
remittances <- subset(remittances,value>0)
remittances <- merge(remittances
,depth
,by=c("country.id")
,all.x=TRUE)
remittances <- transform(remittances,color=treeMapRamp(depth))
oda <- subset(oda,depth>0)
treemap(oda
,index="name.y"
,vSize="value"
,vColor="color"
,type="color"
,title=""
,lowerbound.cex.labels=1
,fontsize.labels=30
,inflate.labels=TRUE
)
treemap(oda
,index="name.y"
,vSize="value"
,vColor="color"
,type="color"
,title=""
,lowerbound.cex.labels=1
,fontsize.labels=20
,inflate.labels=TRUE
)
treemap(oda
,index="name.y"
,vSize="value"
,vColor="color"
,type="color"
,title=""
,lowerbound.cex.labels=1
,fontsize.labels=25
,inflate.labels=TRUE
)
fdi <- subset(fdi,depth>0)
remittances <- subset(remittances,depth>0)
longdebt <- subset(longdebt,depth>0)
treemap(fdi
,index="name.y"
,vSize="value"
,vColor="color"
,type="color"
,title=""
,lowerbound.cex.labels=1
,fontsize.labels=25
,inflate.labels=TRUE
)
treemap(remittances
,index="name.y"
,vSize="value"
,vColor="color"
,type="color"
,title=""
,lowerbound.cex.labels=1
,fontsize.labels=25
,inflate.labels=TRUE
)
treemap(longdebt
,index="name.y"
,vSize="value"
,vColor="color"
,type="color"
,title=""
,lowerbound.cex.labels=1
,fontsize.labels=25
,inflate.labels=TRUE
)
names(fdi)
sum(fdi$value,na.rm=TRUE)
sum(remittances$value,na.rm=TRUE)
sum(oda$value,na.rm=TRUE)
