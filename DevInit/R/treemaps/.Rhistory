#install.packages("openxlsx")
library(openxlsx)
#Write####
setwd("C:/Users/alexm/Documents/Rwork")
for(i in 8:9){
size <- 1*(10^i)
df <- data.frame(rnorm(size),rnorm(size),rnorm(size),rnorm(size),rnorm(size),rnorm(size),rnorm(size),rnorm(size),rnorm(size),rnorm(size))
write.csv(df,paste0("df",i,".csv"))
#write.xlsx(df,paste0("df",i,".xlsx"))
};
df <- read.csv("df8.csv")
#install.packages("rsdmx")
#install.packages("plyr")
#install.packages("dplyr")
#install.packages("httpuv")
library(rsdmx)
library(plyr)
suppressPackageStartupMessages(library("dplyr"))
library(httpuv)
#OECD Codelist Func####
OECDCode <- function(indicator){
#Structure URL
sRoot <- "http://stats.oecd.org/restsdmx/sdmx.ashx/GetDataStructure/"
t1sUrl <- paste0(sRoot
,indicator
)
#Fetch data
t1ssdmx <- readSDMX(t1sUrl)
#get codelists
cls <- t1ssdmx@codelists
codelists <- sapply(cls@codelists, function(x) x@id)
#Flatten
variable <- c()
id <- c()
name <- c()
for(i in 1:length(codelists)){
suffix <- paste("CL_",indicator,"_",sep="")
clName <- substr(codelists[i],nchar(suffix)+1,nchar(codelists[i]))
codelist <- cls@codelists[i][[1]]@Code
for(j in 1:length(codelist)){
ID <- codelist[j][[1]]@id
NAME <- codelist[j][[1]]@label$en
id <- c(id,ID)
name <- c(name,NAME)
variable <- c(variable,clName)
}
df <- data.frame(variable,id,name)
}
#return
return(df)
}
#E.g.####
codes <- OECDCode("TABLE2A")
who_donor <- subset(codes,variable=="DONOR" & name=="WHO")
codes <- OECDCode("TABLE2A")
View(codes)
library(rvest)
,"GB-3")
library(jsonlite)
gbs <- c(
"GB-1"
,"GB-3"
,"GB-4"
,"GB-6"
,"GB-7"
,"GB-9"
,"GB-10"
,"XM-DAC-12-22"
,"GB-GOV-8"
,"GB-COH-RC000346"
)
i <- 1
gb <- gbs[i]
url <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat <- fromJSON(url)
View(dat)
View(dat[1])
View(dat[2])
View(dat[3])
View(dat[4])
View(dat[5])
View(dat[4])
View(dat[5])
View(dat[6])
dat <- fromJSON(url)[1]
dat <- fromJSON(url)[[1]]
View(dat)
?html_node
overviewUrl <- paste0("http://www.d-portal.org/ctrack.html?publisher=",gb,"&tongue=eng#view=publisher")
page <- html(overviewUrl)
donorname <- page %>%
html_node(".name.publisher") %>%
html_text()
donorname <- page %>%
html_node(".name.publisher")
donorname <- page %>%
html_node(".name .publisher") %>%
html_text()
donorname <- page %>%
html_node(".name")
donorname <- page %>%
html_nodes("td")
overviewUrl
datstats <- fromJSON(statsUrl)
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
datstats <- fromJSON(statsUrl)
datstats <- fromJSON(statsUrl)[[1]]
View(datstats)
datstats <- fromJSON(statsUrl)[[1]]["MAX(reporting)"]
datstats <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
library(jsonlite)
gbs <- c(
"GB-1"
,"GB-3"
,"GB-4"
,"GB-6"
,"GB-7"
,"GB-9"
,"GB-10"
,"XM-DAC-12-22"
,"GB-GOV-8"
,"GB-COH-RC000346"
)
i <- 1
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
2013url <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(2013url)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
2014url <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(2014url)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
2015url <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(2014url)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
dat <- rbind(dat2013,dat2014,dat2015)
2013url <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(2013url)[[1]]
2013url <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
dat <- rbind(dat2013,dat2014,dat2015)
View(dat2013)
View(dat2014)
View(dat2015)
View(dat2014)
View(dat2013)
View(dat2014)
View(dat2015)
View(dat2014)
View(dat2014)
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
dat <- rbind(dat2013,dat2014,dat2015)
View(dat)
library(foreach)
library(jsonlite)
library(foreach)
gbs <- c(
"GB-1"
,"GB-3"
,"GB-4"
,"GB-6"
,"GB-7"
,"GB-9"
,"GB-10"
,"XM-DAC-12-22"
,"GB-GOV-8"
,"GB-COH-RC000346"
)
data <- foreach(i=1:length(gbs),.packages=c("jsonlite")
,.combine=rbind) %do% {
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
dat <- rbind(dat2013,dat2014,dat2015)
return(dat)
}
library(jsonlite)
library(foreach)
gbs <- c(
"GB-1"
,"GB-3"
,"GB-4"
,"GB-6"
,"GB-7"
,"GB-9"
,"GB-10"
#,"XM-DAC-12-22"
,"GB-GOV-8"
,"GB-COH-RC000346"
)
data <- foreach(i=1:length(gbs),.packages=c("jsonlite")
,.combine=rbind) %do% {
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
dat <- rbind(dat2013,dat2014,dat2015)
return(dat)
}
View(dat)
?rbind
i <- 1
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
dat <- rbind(dat2013,dat2014,dat2015)
View(dat)
i <- 5
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
dat <- rbind(dat2013,dat2014,dat2015)
View(dat2013[[1]])
View(dat2013[[2]])
i <- 2
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
i <- 3
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
nrow(dat2013)
nrow(dat2015)
is.null(nrow(dat2015))
empty <- fromJSON("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=GB-1&view=publisher_sectors&_=1441789807497")
empty <- fromJSON("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=GB-1&view=publisher_sectors&_=1441789807497")[[1]]
empty <- fromJSON("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=GB-1&view=publisher_sectors&_=1441789807497")[[1]][0,]
View(empty)
empty$year <- NA
empty$donor <- NA
numeric(0)
typeof(0)
empty$year <- double(0)
empty$donor <- character(0)
i
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
nrow(dat2015)
library(jsonlite)
library(foreach)
gbs <- c(
"GB-1"
,"GB-3"
,"GB-4"
,"GB-6"
,"GB-7"
,"GB-9"
,"GB-10"
#,"XM-DAC-12-22"
,"GB-GOV-8"
,"GB-COH-RC000346"
)
empty <- fromJSON("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=GB-1&view=publisher_sectors&_=1441789807497")[[1]][0,]
empty$year <- double(0)
empty$donor <- character(0)
data <- foreach(i=1:length(gbs),.packages=c("jsonlite")
,.combine=rbind) %do% {
gb <- gbs[i]
statsUrl <- paste0("http://www.d-portal.org/q?select=stats&from=act&reporting_ref=",gb,"&view=publisher&_=1441790527948")
donorname <- fromJSON(statsUrl)[[1]]["MAX(reporting)"][1,1]
message(donorname)
url2013 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2013-01-01&trans_day_lt=2014-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807495")
dat2013 <- fromJSON(url2013)[[1]]
dat2013$year <- 2013
dat2013$donor <- donorname
if(is.null(nrow(dat2013))){
dat2013 <- empty
}
url2014 <- paste0("http://www.d-portal.org/q?from=act%2Ctrans%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_trans_usd&groupby=sector_code&trans_code=D%7CE&trans_day_gteq=2014-01-01&trans_day_lt=2015-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807497")
dat2014 <- fromJSON(url2014)[[1]]
dat2014$year <- 2014
dat2014$donor <- donorname
if(is.null(nrow(dat2014))){
dat2014 <- empty
}
url2015 <- paste0("http://www.d-portal.org/q?from=act%2Cbudget%2Csector&limit=-1&select=sector_code%2Csum_of_percent_of_budget_usd&budget_priority=1&groupby=sector_code&budget_day_end_gteq=2015-01-01&budget_day_end_lt=2016-01-01&reporting_ref=",gb,"&view=publisher_sectors&_=1441789807501")
dat2015 <- fromJSON(url2015)[[1]]
dat2015$year <- 2015
dat2015$donor <- donorname
names(dat2015)[2] <- "sum_of_percent_of_trans_usd"
if(is.null(nrow(dat2015))){
dat2015 <- empty
}
dat <- rbind(dat2013,dat2014,dat2015)
return(dat)
}
View(data)
unique(data$donor)
#install.packages("treemap")
library(treemap)
wd <- "C:/git/alexm-util/DevInit/R/treemaps"
setwd(wd)
data <- read.csv("rob.csv",as.is=TRUE)
data$color <- rep("#ba0c2f")
treemap(subset(data,recip=="Bangladesh")
,index="flow"
,vSize="value"
,title="Bangladesh"
,vColor="color"
,type="color"
)
treemap(subset(data,recip=="Ethiopia")
,index="flow"
,vSize="value"
,title="Ethiopia"
,vColor="color"
,type="color"
)
treemap(subset(data,recip=="Ethiopia")
,index="flow"
,vSize="value"
,title="Ethiopia"
,vColor="color"
,type="color"
)
treemap(subset(data,recip=="Bangladesh")
,index="flow"
,vSize="value"
,title="Bangladesh"
,vColor="color"
,type="color"
)
treemap(subset(data,recip=="Ethiopia")
,index="flow"
,vSize="value"
,title="Ethiopia"
,vColor="color"
,type="color"
)
treemap(subset(data,recip=="Uganda")
,index="flow"
,vSize="value"
,title="Uganda"
,vColor="color"
,type="color"
)
