}
rawJson <- fromJSON(content)
rawData <- rawJson$dataSets[[1]]$observations
rawStructure <- rawJson$structure
dimensions <- rawStructure$dimensions[[1]]
attributes <- rawStructure$attributes$observation
names <- c(sapply(dimensions, "[[", 2),"obsValue",sapply(attributes, "[[", 1))
ndim <- length(sapply(dimensions, "[[", 2))
natt <- 1+length(sapply(attributes, "[[", 1))
ncol <- ndim+natt
data <- setNames(data.frame(matrix(ncol = ncol, nrow = 0)),names)
for(i in 1:length(rawData)){
row <- rawData[i]
rawDimensions <- names(row)
splitDimensions <- strsplit(rawDimensions,":")[[1]]
for(j in 1:length(splitDimensions)){
dimensionReference <- dimensions[[j]]$values
dimensionIndex <- as.integer(splitDimensions[j])+1
dimensionValue <- dimensionReference[[dimensionIndex]][[2]]
data[i,j] <- dimensionValue
}
for(j in 1:length(row[[1]])){
if(j>1){
attributeReference <- attributes[[j-1]]$values
rawAttIndex <- row[[1]][[j]]
if(is.null(rawAttIndex)){
attributeValue <- NA
}else{
attributeIndex <- as.integer(rawAttIndex)+1
attributeValue <- attributeReference[[attributeIndex]][[2]]
}
}else{
attributeValue <- as.double(row[[1]][[j]])
}
data[i,ndim+j] <- attributeValue
}
}
names(data)[which(names(data)=="Year")] <- "obsTime"
return(data)
}
url <- "http://stats.oecd.org/SDMX-JSON/data/TABLE1/20005+20001.1.5+1010+2102.1121+1122.A+D+N/all?startTime=2005&endTime=2014&dimensionAtObservation=allDimensions"
data <- OECD(url)
url <- "http://stats.oecd.org/SDMX-JSON/data/TABLE1/20005+20001+801+1+2+301+68+3+18+4+5+40+20+21+6+701+742+22+7+820+8+76+9+69+61+50+10+11+12+302+20002+918+20006+72+62+30+82+75+546+552+83+70+84+45+77+87+566+732+764+55+576+20007.1.5+1010+1015+1100+1110+1120+1200+1210+1211+1212+1213+1214+1220+1230+1300+1310+1311+1320+1330+1301+1400+1410+1420+1500+1510+1520+1600+1610+1611+1612+1613+1614+1620+1621+1622+1623+1624+1630+1640+1700+1800+1810+1820+1900+1999+99999+1901+1902+1903+1904+1905+1906+60+70+2000+2100+2101+2102+2103+2104+547+2105+2106+2107+2108+2110+2901+2902+230+235+240+265+266+294+291+292+293+280+287+300+301+302+310+303+295+299+298+102+325+326+327+795+800+805+786+330+332+340+345+353+384+751+752+753+386+756+761+388+389+103+359+415+425+420+207+1+2+3+4.1121+1122+1120+1130+1140+1151+1152+1150.A+D+N/all?startTime=2005&endTime=2014&dimensionAtObservation=allDimensions"
data <- OECD(url)
View(data)
content <- getURL(url, httpheader = list('User-Agent' = 'rsdmx-json/0.0.1'), ssl.verifypeer = FALSE, .encoding = "UTF-8")
BOM <- "\ufeff"
if(attr(regexpr(BOM, content), "match.length") != - 1){
content <- gsub(BOM, "", content)
}
rawJson <- fromJSON(content)
rawData <- rawJson$dataSets[[1]]$observations
rawStructure <- rawJson$structure
dimensions <- rawStructure$dimensions[[1]]
attributes <- rawStructure$attributes$observation
names <- c(sapply(dimensions, "[[", 2),"obsValue",sapply(attributes, "[[", 1))
ndim <- length(sapply(dimensions, "[[", 2))
natt <- 1+length(sapply(attributes, "[[", 1))
ncol <- ndim+natt
data <- setNames(data.frame(matrix(ncol = ncol, nrow = 0)),names)
for(i in 1:length(rawData)){
row <- rawData[i]
rawDimensions <- names(row)
splitDimensions <- strsplit(rawDimensions,":")[[1]]
for(j in 1:length(splitDimensions)){
dimensionReference <- dimensions[[j]]$values
dimensionIndex <- as.integer(splitDimensions[j])+1
dimensionValue <- dimensionReference[[dimensionIndex]][[2]]
data[i,j] <- dimensionValue
}
for(j in 1:length(row[[1]])){
if(j>1){
attributeReference <- attributes[[j-1]]$values
rawAttIndex <- row[[1]][[j]]
if(is.null(rawAttIndex)){
attributeValue <- NA
}else{
attributeIndex <- as.integer(rawAttIndex)+1
attributeValue <- attributeReference[[attributeIndex]][[2]]
}
}else{
attributeValue <- as.double(row[[1]][[j]])
}
data[i,ndim+j] <- attributeValue
}
}
length(rawData)
data <- setNames(data.frame(matrix(ncol = ncol, nrow = length(rawData))),names)
data <- setNames(data.frame(matrix(ncol = ncol, nrow = length(rawData))),names)
for(i in 1:length(rawData)){
row <- rawData[i]
rawDimensions <- names(row)
splitDimensions <- strsplit(rawDimensions,":")[[1]]
for(j in 1:length(splitDimensions)){
dimensionReference <- dimensions[[j]]$values
dimensionIndex <- as.integer(splitDimensions[j])+1
dimensionValue <- dimensionReference[[dimensionIndex]][[2]]
data[i,j] <- dimensionValue
}
for(j in 1:length(row[[1]])){
if(j>1){
attributeReference <- attributes[[j-1]]$values
rawAttIndex <- row[[1]][[j]]
if(is.null(rawAttIndex)){
attributeValue <- NA
}else{
attributeIndex <- as.integer(rawAttIndex)+1
attributeValue <- attributeReference[[attributeIndex]][[2]]
}
}else{
attributeValue <- as.double(row[[1]][[j]])
}
data[i,ndim+j] <- attributeValue
}
}
i
install.packages('timeline', repos='http://cran.r-project.org')
require(timeline)
data(ww2)
timeline(ww2, ww2.events, event.spots=2, event.label='', event.above=FALSE)
library(ggplot2)
timeset<-data.frame(year=c(1986,1995,2011,1990,1998,2010),text=c('I was born','Had a nice icecream','Spotted a dodo','First swim','Crashed my bicycle','Bought a helmet'),y=c(runif(3,.5,1),runif(3,-1,-.5)))
plot<-ggplot(timeset,aes(x=year,y=0))
plot<-plot+geom_segment(aes(y=0,yend=y,xend=year))
plot<-geom_text(aes(y=ytext,label=text),size=2.5,vjust=-1)
plot<-plot+geom_point(aes(y=y))
plot
plot<-plot+scale_y_continuous(limits=c(-2,2))
library(ggplot2)
timeset<-data.frame(year=c(1986,1995,2011,1990,1998,2010),text=c('I was born','Had a nice icecream','Spotted a dodo','First swim','Crashed my bicycle','Bought a helmet'),y=c(runif(3,.5,1),runif(3,-1,-.5)))
plot<-ggplot(timeset,aes(x=year,y=0))
+geom_segment(aes(y=0,yend=y,xend=year))
+geom_text(aes(y=ytext,label=text),size=2.5,vjust=-1)
+geom_point(aes(y=y))
+scale_y_continuous(limits=c(-2,2))
+geom_hline(y=0,size=1,color='purple')   #draw a vertical line
+geom_segment(x=2011.4,xend=2012.2,y=.2,yend=0,color='purple',size=1)
+geom_segment(x=2011.4,xend=2012.2,y=-.2,yend=0,color='purple',size=1) #drawing the actual arrow
library(ggplot2)
timeset<-data.frame(year=c(1986,1995,2011,1990,1998,2010),text=c('I was born','Had a nice icecream','Spotted a dodo','First swim','Crashed my bicycle','Bought a helmet'),y=c(runif(3,.5,1),runif(3,-1,-.5)))
plot<-ggplot(timeset,aes(x=year,y=0))+
geom_segment(aes(y=0,yend=y,xend=year))+
geom_text(aes(y=ytext,label=text),size=2.5,vjust=-1)+
geom_point(aes(y=y))+
scale_y_continuous(limits=c(-2,2))+
geom_hline(y=0,size=1,color='purple')+
geom_segment(x=2011.4,xend=2012.2,y=.2,yend=0,color='purple',size=1)+
geom_segment(x=2011.4,xend=2012.2,y=-.2,yend=0,color='purple',size=1) #drawing the actual arrow
plot
library(ggplot2)
timeset<-data.frame(year=c(1986,1995,2011,1990,1998,2010),text=c('I was born','Had a nice icecream','Spotted a dodo','First swim','Crashed my bicycle','Bought a helmet'),y=c(runif(3,.5,1),runif(3,-1,-.5)))
plot<-ggplot(timeset,aes(x=year,y=0))+
geom_segment(aes(y=0,yend=y,xend=year))+
geom_text(aes(y=text,label=text),size=2.5,vjust=-1)+
geom_point(aes(y=y))+
scale_y_continuous(limits=c(-2,2))+
geom_hline(y=0,size=1,color='purple')+
geom_segment(x=2011.4,xend=2012.2,y=.2,yend=0,color='purple',size=1)+
geom_segment(x=2011.4,xend=2012.2,y=-.2,yend=0,color='purple',size=1) #drawing the actual arrow
plot
plot<-ggplot(timeset,aes(x=year,y=0))
library(ggplot2)
timeset<-data.frame(year=c(1986,1995,2011,1990,1998,2010),text=c('I was born','Had a nice icecream','Spotted a dodo','First swim','Crashed my bicycle','Bought a helmet'),y=c(runif(3,.5,1),runif(3,-1,-.5)))
plot<-ggplot(timeset,aes(x=year,y=0))+
geom_segment(aes(y=0,yend=y,xend=year))+
geom_text(aes(y=y,label=text),size=2.5,vjust=-1)+
geom_point(aes(y=y))+
scale_y_continuous(limits=c(-2,2))+
geom_hline(y=0,size=1,color='purple')+
geom_segment(x=2011.4,xend=2012.2,y=.2,yend=0,color='purple',size=1)+
geom_segment(x=2011.4,xend=2012.2,y=-.2,yend=0,color='purple',size=1) #drawing the actual arrow
plot
library(ggplot2)
timeset<-data.frame(year=c(1986,1995,2011,1990,1998,2010),text=c('I was born','Had a nice icecream','Spotted a dodo','First swim','Crashed my bicycle','Bought a helmet'),y=c(runif(3,.5,1),runif(3,-1,-.5)))
plot<-ggplot(timeset,aes(x=year,y=0))+
geom_segment(aes(y=0,yend=y,xend=year))+
geom_text(aes(y=y,label=text),size=2.5,vjust=-1)+
geom_point(aes(y=y))+
scale_y_continuous(limits=c(-2,2))+
geom_hline(y=0,size=1,color='purple')+
geom_segment(x=2011.4,xend=2012.2,y=.2,yend=0,color='purple',size=1)+
geom_segment(x=2011.4,xend=2012.2,y=-.2,yend=0,color='purple',size=1) #drawing the actual arrow
plot
?grepl
outfilename <- "D:/Documents/data/APR_16_14_tsla.csv"
df <- read.csv(outfilename
,header=TRUE
,colClasses=c("myDate","numeric","character","numeric","numeric","numeric"))
timestamp <- paste0(
"\nExpiry: "
,df[1,1]
,"\nCalculated: "
,Sys.Date()
)
change_averages <- ddply(df,.(change,state),summarize,avg=mean(prob))
title <- paste0(
"Probability of up/neutral/down given percent change",
timestamp
)
p1 <- ggplot(data=change_averages,aes(x=change,y=avg,group=state,colour=state)) +
geom_line() +
geom_point() +
ggtitle(title)
p1
#install.packages("ggplot2")
#install.packages("dplyr")
library(ggplot2)
library(plyr)
library(scales)
input <- "urbn"
percentMax <- 40
windows <- TRUE
if(windows){pathpre<-"C:"}else{pathpre<-"~"}
wd <- paste0(pathpre,"/git/alexm-util/Finance/")
setwd(wd)
now <- Sys.Date()
dateFolder <- paste0("data/",input,"_",now,"/")
dir.create(dateFolder)
infilename <- paste0("data/",input,".csv")
raw <- read.csv(
infilename
,header=FALSE
,skip=7
,as.is=TRUE
)
splitdate <- function(x){
return(gsub("___","_",gsub("[ ()]","_",strsplit(x,"100")[[1]][1]),fixed=TRUE))
}
dates <- unique(raw[,1])
dates <- subset(dates,dates!="")
dates <- sapply(dates,splitdate)
setClass("myDate")
setAs("character","myDate", function(from) as.Date(from, format="%m/%d/%y"))
if(exists("panelAverages")){rm(panelAverages)}
for(i in 1:length(dates)){
outfilename <- paste0(dateFolder,dates[i],input,".csv")
command <- paste("node ha_tos2.js",infilename,(i-1),outfilename,percentMax)
system(command)
df <- read.csv(outfilename
,header=TRUE
,colClasses=c("myDate","numeric","character","numeric","numeric","numeric"))
if(nrow(df)>0){
if(!exists("panelAverages")){
panelAverages <- ddply(df,.(date,state,strike),summarize,avg=mean(prob),sd=sd(prob),count=length(prob))
}else{
panelAverage <- ddply(df,.(date,state,strike),summarize,avg=mean(prob),sd=sd(prob),count=length(prob))
panelAverages <- rbind(panelAverages,panelAverage)
}
timestamp <- paste0(
"\nExpiry: "
,df[1,1]
,"\nCalculated: "
,Sys.Date()
)
change_averages <- ddply(df,.(change,state),summarize,avg=mean(prob))
title <- paste0(
"Probability of up/neutral/down given percent change",
timestamp
)
p1 <- ggplot(data=change_averages,aes(x=change,y=avg,group=state,colour=state)) +
geom_line() +
geom_point() +
ggtitle(title)
ggsave(paste0(dateFolder,"p1-",df[1,1],".jpg"),plot=p1,height=7,width=14)
strike_averages <- ddply(df,.(strike,state),summarize,avg=mean(prob),sd=sd(prob),count=length(prob))
title <- paste0(
"Probability of up/neutral/down given strike",
timestamp
)
p2 <- ggplot(data=strike_averages,aes(x=strike,y=avg,ymax=avg+sd,ymin=avg-sd,group=state,colour=state)) +
geom_point(size=3) +
geom_errorbar(width=0.2) +
ggtitle(title)
ggsave(paste0(dateFolder,"p2-",df[1,1],".jpg"),plot=p2,height=7,width=14)
#Density
jpeg(
file=paste0(dateFolder,"p3-",df[1,1],".jpg")
,width=14
,height=7
,res=300
,units="in"
)
par(mfrow=c(3, 1))
states <- unique(df$state)
for (i in 1:length(states)) {
d <- density(df[which(df$state==states[i]),]$prob)
plot(d, type="n", main=paste("Kernal density",states[i],"states",timestamp))
polygon(d,  border="#ba0c2f", col="#ba0c2f")
}
dev.off()
par(mfrow=c(1, 1))
}
}
underlying <- 32.47
percent <- 0.0286*2
sub <- subset(averages,strike>=(underlying*(1-percent)) & strike<=(underlying*(1+percent)))
#sub <- panelAverages
limited_averages <- ddply(sub,.(date,state),summarize,avg=mean(avg),sd=mean(sd),count=sum(count))
p3 <- ggplot(data=limited_averages,aes(x=date,y=avg,ymax=avg+sd,ymin=avg-sd,group=state,colour=state)) +
#   scale_x_date(date_breaks = "2 months") +
geom_line(size=1) +
geom_point(size=3) +
geom_errorbar(width=0.2)
ggsave(paste0(dateFolder,"p4.jpg"),plot=p3,height=7,width=14)
#install.packages("ggplot2")
#install.packages("dplyr")
library(ggplot2)
library(plyr)
library(scales)
input <- "urbn"
percentMax <- 40
windows <- TRUE
if(windows){pathpre<-"C:"}else{pathpre<-"~"}
wd <- paste0(pathpre,"/git/alexm-util/Finance/")
setwd(wd)
now <- Sys.Date()
dateFolder <- paste0("data/",input,"_",now,"/")
dir.create(dateFolder)
infilename <- paste0("data/",input,".csv")
raw <- read.csv(
infilename
,header=FALSE
,skip=7
,as.is=TRUE
)
splitdate <- function(x){
return(gsub("___","_",gsub("[ ()]","_",strsplit(x,"100")[[1]][1]),fixed=TRUE))
}
dates <- unique(raw[,1])
dates <- subset(dates,dates!="")
dates <- sapply(dates,splitdate)
setClass("myDate")
setAs("character","myDate", function(from) as.Date(from, format="%m/%d/%y"))
if(exists("panelAverages")){rm(panelAverages)}
for(i in 1:length(dates)){
outfilename <- paste0(dateFolder,dates[i],input,".csv")
command <- paste("node ha_tos2.js",infilename,(i-1),outfilename,percentMax)
system(command)
df <- read.csv(outfilename
,header=TRUE
,colClasses=c("myDate","numeric","character","numeric","numeric","numeric"))
if(nrow(df)>0){
if(!exists("panelAverages")){
panelAverages <- ddply(df,.(date,state,strike),summarize,avg=mean(prob),sd=sd(prob),count=length(prob))
}else{
panelAverage <- ddply(df,.(date,state,strike),summarize,avg=mean(prob),sd=sd(prob),count=length(prob))
panelAverages <- rbind(panelAverages,panelAverage)
}
timestamp <- paste0(
"\nExpiry: "
,df[1,1]
,"\nCalculated: "
,Sys.Date()
)
change_averages <- ddply(df,.(change,state),summarize,avg=mean(prob))
title <- paste0(
"Probability of up/neutral/down given percent change",
timestamp
)
p1 <- ggplot(data=change_averages,aes(x=change,y=avg,group=state,colour=state)) +
geom_line() +
geom_point() +
ggtitle(title)
ggsave(paste0(dateFolder,"p1-",df[1,1],".jpg"),plot=p1,height=7,width=14)
strike_averages <- ddply(df,.(strike,state),summarize,avg=mean(prob),sd=sd(prob),count=length(prob))
title <- paste0(
"Probability of up/neutral/down given strike",
timestamp
)
p2 <- ggplot(data=strike_averages,aes(x=strike,y=avg,ymax=avg+sd,ymin=avg-sd,group=state,colour=state)) +
geom_point(size=3) +
geom_errorbar(width=0.2) +
ggtitle(title)
ggsave(paste0(dateFolder,"p2-",df[1,1],".jpg"),plot=p2,height=7,width=14)
#Density
jpeg(
file=paste0(dateFolder,"p3-",df[1,1],".jpg")
,width=14
,height=7
,res=300
,units="in"
)
par(mfrow=c(3, 1))
states <- unique(df$state)
for (i in 1:length(states)) {
d <- density(df[which(df$state==states[i]),]$prob)
plot(d, type="n", main=paste("Kernal density",states[i],"states",timestamp))
polygon(d,  border="#ba0c2f", col="#ba0c2f")
}
dev.off()
par(mfrow=c(1, 1))
}
}
underlying <- 32.47
percent <- 0.0286*2
sub <- subset(averages,strike>=(underlying*(1-percent)) & strike<=(underlying*(1+percent)))
#sub <- panelAverages
limited_averages <- ddply(sub,.(date,state),summarize,avg=mean(avg),sd=mean(sd),count=sum(count))
p3 <- ggplot(data=limited_averages,aes(x=date,y=avg,ymax=avg+sd,ymin=avg-sd,group=state,colour=state)) +
#   scale_x_date(date_breaks = "2 months") +
geom_line(size=1) +
geom_point(size=3) +
geom_errorbar(width=0.2)
ggsave(paste0(dateFolder,"p4.jpg"),plot=p3,height=7,width=14)
#install.packages("ggplot2")
#install.packages("dplyr")
library(ggplot2)
library(plyr)
library(scales)
input <- "urbn"
percentMax <- 40
windows <- TRUE
if(windows){pathpre<-"C:"}else{pathpre<-"~"}
wd <- paste0(pathpre,"/git/alexm-util/Finance/")
setwd(wd)
now <- Sys.Date()
dateFolder <- paste0("data/",input,"_",now,"/")
dir.create(dateFolder)
infilename <- paste0("data/",input,".csv")
raw <- read.csv(
infilename
,header=FALSE
,skip=7
,as.is=TRUE
)
splitdate <- function(x){
return(gsub("___","_",gsub("[ ()]","_",strsplit(x,"100")[[1]][1]),fixed=TRUE))
}
dates <- unique(raw[,1])
dates <- subset(dates,dates!="")
dates <- sapply(dates,splitdate)
setClass("myDate")
setAs("character","myDate", function(from) as.Date(from, format="%m/%d/%y"))
if(exists("panelAverages")){rm(panelAverages)}
for(i in 1:length(dates)){
outfilename <- paste0(dateFolder,dates[i],input,".csv")
command <- paste("node ha_tos2.js",infilename,(i-1),outfilename,percentMax)
system(command)
df <- read.csv(outfilename
,header=TRUE
,colClasses=c("myDate","numeric","character","numeric","numeric","numeric"))
if(nrow(df)>0){
if(!exists("panelAverages")){
panelAverages <- ddply(df,.(date,state,strike),summarize,avg=mean(prob),sd=sd(prob),count=length(prob))
}else{
panelAverage <- ddply(df,.(date,state,strike),summarize,avg=mean(prob),sd=sd(prob),count=length(prob))
panelAverages <- rbind(panelAverages,panelAverage)
}
timestamp <- paste0(
"\nExpiry: "
,df[1,1]
,"\nCalculated: "
,Sys.Date()
)
change_averages <- ddply(df,.(change,state),summarize,avg=mean(prob))
title <- paste0(
"Probability of up/neutral/down given percent change",
timestamp
)
p1 <- ggplot(data=change_averages,aes(x=change,y=avg,group=state,colour=state)) +
geom_line() +
geom_point() +
ggtitle(title)
ggsave(paste0(dateFolder,"p1-",df[1,1],".jpg"),plot=p1,height=7,width=14)
strike_averages <- ddply(df,.(strike,state),summarize,avg=mean(prob),sd=sd(prob),count=length(prob))
title <- paste0(
"Probability of up/neutral/down given strike",
timestamp
)
p2 <- ggplot(data=strike_averages,aes(x=strike,y=avg,ymax=avg+sd,ymin=avg-sd,group=state,colour=state)) +
geom_point(size=3) +
geom_errorbar(width=0.2) +
ggtitle(title)
ggsave(paste0(dateFolder,"p2-",df[1,1],".jpg"),plot=p2,height=7,width=14)
#Density
jpeg(
file=paste0(dateFolder,"p3-",df[1,1],".jpg")
,width=14
,height=7
,res=300
,units="in"
)
par(mfrow=c(3, 1))
states <- unique(df$state)
for (i in 1:length(states)) {
d <- density(df[which(df$state==states[i]),]$prob)
plot(d, type="n", main=paste("Kernal density",states[i],"states",timestamp))
polygon(d,  border="#ba0c2f", col="#ba0c2f")
}
dev.off()
par(mfrow=c(1, 1))
}
}
underlying <- 32.47
percent <- 0.0286*2
sub <- subset(averages,strike>=(underlying*(1-percent)) & strike<=(underlying*(1+percent)))
#sub <- panelAverages
limited_averages <- ddply(sub,.(date,state),summarize,avg=mean(avg),sd=mean(sd),count=sum(count))
p3 <- ggplot(data=limited_averages,aes(x=date,y=avg,ymax=avg+sd,ymin=avg-sd,group=state,colour=state)) +
#   scale_x_date(date_breaks = "2 months") +
geom_line(size=1) +
geom_point(size=3) +
geom_errorbar(width=0.2)
ggsave(paste0(dateFolder,"p4.jpg"),plot=p3,height=7,width=14)
sub <- subset(panelAverages,strike>=(underlying*(1-percent)) & strike<=(underlying*(1+percent)))
limited_averages <- ddply(sub,.(date,state),summarize,avg=mean(avg),sd=mean(sd),count=sum(count))
p3 <- ggplot(data=limited_averages,aes(x=date,y=avg,ymax=avg+sd,ymin=avg-sd,group=state,colour=state)) +
#   scale_x_date(date_breaks = "2 months") +
geom_line(size=1) +
geom_point(size=3) +
geom_errorbar(width=0.2)
ggsave(paste0(dateFolder,"p4.jpg"),plot=p3,height=7,width=14)
